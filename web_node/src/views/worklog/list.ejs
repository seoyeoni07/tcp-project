<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title><%= title %></title>

  <link rel="stylesheet" href="/css/design-system.css" />
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="/css/nav.css" />

    <style>
    .board-wrap {
      max-width: 1000px;
      margin: 0 auto;
      padding: 24px 32px 60px;
    }

    .board-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 28px;
    }

    .board-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0;
    }

    .board-header-right {
      display: flex;
      align-items: center;
    }

    .board-header-right .meeting-nav-form {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .meeting-month-label {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
      min-width: 100px;
      text-align: center;
    }

    .meeting-today-btn {
      margin-left: 4px;
    }

    .calendar-wrap {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      padding: 16px;
      max-width: 950px;
      margin: 0 auto;
    }

    .calendar-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      font-size: 13px;
    }

    .calendar-table th,
    .calendar-table td {
      border: 1px solid #e5e7eb;
      padding: 6px;
      text-align: left;
      height: 70px;
      vertical-align: top;
      width: calc(100% / 7);
    }

    .calendar-table th {
      background-color: #f9fafb;
      font-weight: 600;
      font-size: 13px;
      padding: 10px 6px;
      text-align: center;
    }

    .calendar-table th:first-child {
      color: #ef4444;
    }
    .calendar-table th:last-child {
      color: #1d4ed8;
    }

    .cal-date {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
      color: var(--text-primary);
    }

    .cal-item {
      display: block;
      font-size: 11px;
      background-color: #2563eb;
      color: white;
      padding: 3px 6px;
      border-radius: 4px;
      margin-top: 3px;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      text-decoration: none;
      max-width: 100%;
      line-height: 1.3;
    }

    .cal-item:hover {
      background-color: #1d4ed8;
    }

    .cal-empty-text {
      color: #9ca3af;
      font-size: 11px;
      text-decoration: none;
    }

    .cal-empty-text:hover {
      color: #6b7280;
    }

    .cal-empty {
      background-color: #fafafa;
    }
  </style>
</head>
<body>
  <%- include('../partials/nav', { title, user, active }) %>

    <div class="board-wrap">
    <div class="board-header">
      <h1 class="board-title">업무일지</h1>

      <div class="board-header-right">
        <form method="get" action="/worklog" class="meeting-nav-form">
          <input type="hidden" name="year" value="<%= year %>">
          <input type="hidden" name="month" value="<%= month %>">

          <button type="submit"
                  name="prev"
                  value="1"
                  class="btn btn-secondary btn-sm">
            ◀
          </button>

          <span class="meeting-month-label">
            <%= year %>년 <%= month %>월
          </span>

          <button type="submit"
                  name="next"
                  value="1"
                  class="btn btn-secondary btn-sm">
            ▶
          </button>

          <a href="/worklog"
             class="btn btn-primary btn-sm meeting-today-btn">
            오늘
          </a>
        </form>
      </div>
    </div>

    <div class="calendar-wrap">
      <table class="calendar-table">
        <thead>
          <tr>
            <th>일</th>
            <th>월</th>
            <th>화</th>
            <th>수</th>
            <th>목</th>
            <th>금</th>
            <th>토</th>
          </tr>
        </thead>
        <tbody>
          <% 
          var firstDate = new Date(year, month - 1, 1);
          var firstDay  = firstDate.getDay();
          var lastDate  = new Date(year, month, 0).getDate();
          var day       = 1 - firstDay;

          for (var week = 0; week < 6; week++) { 
          %>
            <tr>
              <% 
              for (var d = 0; d < 7; d++, day++) {
                var valid = (day >= 1 && day <= lastDate);
                var yyyy  = String(year);
                var mm    = String(month); if (mm.length === 1) mm = '0' + mm;
                var dd    = String(day);   if (dd.length === 1) dd = '0' + dd;
                var key   = valid ? (yyyy + '-' + mm + '-' + dd) : null;
                var items = valid ? (logsByDate[key] || []) : [];
              %>
                <td class="<%= valid ? 'cal-cell' : 'cal-empty' %>" data-date="<%= key %>">
                  <% if (valid) { %>
                    <div class="cal-date"><%= day %></div>
                    <div class="cal-badges">
                      <% if (items.length > 0) { %>
                        <% if (user.role === 'admin') { %>
                          <a href="/worklog/day/<%= key %>" class="cal-item"
                             style="background-color:#007bff; text-align:center;">
                            <%= items.length %>건 조회하기
                          </a>
                        <% } else { %>
                          <a href="/worklog/<%= items[0].log_id %>" class="cal-item"
                             title="<%= items[0].work_time ? '근무 시간: ' + items[0].work_time : '' %>">
                            <%= items[0].title %>
                          </a>
                        <% } %>
                      <% } else { %>
                        <a href="/worklog/new?date=<%= key %>" class="cal-empty-text">
                          + 작성하기
                        </a>
                      <% } %>
                    </div>
                  <% } %>
                </td>
              <% } %>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>
