<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>게시판</title>
  <link rel="stylesheet" href="/css/design-system.css" />
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="/css/nav.css" />
</head>

<body>

  <%- include('partials/nav', { title, user, active: 'board' }) %>

  <div class="board-wrap">
    <div class="board-header">
      <h1 class="board-title">게시판</h1>

      <!-- 검색 -->
      <form class="board-search" method="get" action="/board">
        <input type="text" name="q" placeholder="제목 검색" value="<%= q %>" />
        <button type="submit" class="btn">검색</button>
        <% if (q) { %>
          <a href="/board" class="btn btn-light">전체</a>
        <% } %>
      </form>
    </div>

    <!-- 게시글 -->
    <table class="board-table">
      <colgroup>
        <col style="width:90px" />
        <col />
        <col style="width:160px" />
        <col style="width:140px" />
        <col style="width:90px" />
      </colgroup>

      <thead>
        <tr>
          <th class="col-no">번호</th>
          <th class="col-title">제목</th>
          <th class="col-author">작성자</th>
          <th class="col-date">작성일</th>
          <th class="col-views">조회수</th>
        </tr>
      </thead>

      <tbody>
        <% const hasNotices = Array.isArray(notices) && notices.length > 0; %>
        <% const hasPosts   = Array.isArray(posts)   && posts.length   > 0; %>

        <!-- 공지 목록 -->
        <% if (hasNotices) { %>
          <% notices.forEach(post => { %>
            <tr class="row-notice">
              <td class="col-no">공지</td>
              <td class="col-title">
                <span class="badge-notice">공지</span>
                <a class="post-link" href="/board/<%= post.post_id %>">
                  <%= post.title %>
                </a>
              </td>
              <td class="col-author"><%= post.author_name %></td>
              <td class="col-date"><%= post.created_date %></td>
              <td class="col-views"><%= post.views %></td>
            </tr>
          <% }); %>
        <% } %>

        <!-- 글 목록 -->
        <% if (hasPosts) { %>
          <% posts.forEach(post => { %>
            <tr>
              <td class="col-no"><%= post.post_id %></td>
              <td class="col-title">
                <a class="post-link" href="/board/<%= post.post_id %>">
                  <%= post.title %>
                </a>
              </td>
              <td class="col-author"><%= post.author_name %></td>
              <td class="col-date"><%= post.created_date %></td>
              <td class="col-views"><%= post.views %></td>
            </tr>
          <% }); %>
        <% } else if (!hasNotices) { %>
          <tr>
            <td class="empty-row" colspan="5">게시글이 없습니다.</td>
          </tr>
        <% } %>
      </tbody>
    </table>

    <!-- 하단 -->
    <div class="board-foot">
      <div class="pagination">
        <% if (totalPages > 1) { %>
          <% for (let i = 1; i <= totalPages; i++) { %>
            <% 
              const qs = q 
                ? `?q=${encodeURIComponent(q)}&page=${i}` 
                : `?page=${i}`;
            %>

            <% if (i === currentPage) { %>
              <strong><%= i %></strong>
            <% } else { %>
              <a href="/board<%= qs %>"><%= i %></a>
            <% } %>
          <% } %>
        <% } %>
      </div>

      <!-- 글쓰기 버튼 -->
      <a href="/board/new" class="btn btn-primary btn-write">글 쓰기</a>
    </div>
  </div>

  <style>
    body {
      background: var(--bg-page);
    }

    .board-wrap {
      max-width: 1100px;
      margin: 40px auto;
      padding: 32px;
      background: white;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
    }

    .board-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 28px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .board-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0;
    }

    .board-search {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .board-search input[type="text"] {
      padding: 10px 14px;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      font-size: 14px;
      min-width: 240px;
      outline: none;
    }

    .board-search input[type="text"]:focus {
      border-color: var(--primary);
    }

    .board-search button {
      padding: 10px 16px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }

    .board-search button:hover {
      background: #1d4ed8;
    }

    .board-table {
      width: 100%;
      border-collapse: collapse;
      border-radius: var(--radius-md);
      overflow: hidden;
      box-shadow: 0 0 0 1px var(--border-color);
    }

    .board-table th,
    .board-table td {
      padding: 14px 16px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
      font-size: 14px;
    }

    .board-table th {
      background-color: var(--bg-secondary);
      font-weight: 600;
      color: var(--text-primary);
    }

    .board-table td {
      color: var(--text-secondary);
    }

    .board-table tbody tr:last-child td {
      border-bottom: none;
    }

    .col-no,
    .col-author,
    .col-date,
    .col-views {
      text-align: center;
    }

    .post-link {
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 500;
    }

    .post-link:hover {
      color: var(--primary);
      text-decoration: underline;
    }

    .badge-notice {
      display: inline-flex;
      align-items: center;
      padding: 3px 8px;
      background: #fef2f2;
      color: #dc2626;
      border: 1px solid #fecaca;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 700;
      margin-right: 8px;
      vertical-align: middle;
    }

    .row-notice {
      background: #fafafa;
    }

    .row-notice .post-link {
      font-weight: 600;
    }

    .empty-row {
      text-align: center;
      color: var(--text-tertiary);
      padding: 40px !important;
    }

    .board-foot {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 24px;
      gap: 16px;
    }

    .pagination {
      display: flex;
      gap: 6px;
    }

    .pagination a,
    .pagination strong {
      min-width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      text-decoration: none;
      color: var(--text-secondary);
      font-size: 14px;
      transition: all 0.2s;
    }

    .pagination a:hover {
      background: var(--bg-secondary);
      border-color: var(--primary);
      color: var(--primary);
    }

    .pagination strong {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
      font-weight: 600;
    }

    .btn-write {
      padding: 10px 20px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-write:hover {
      background: #1d4ed8;
    }
  </style>
</head>
</body>
</html>